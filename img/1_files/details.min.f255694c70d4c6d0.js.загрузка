(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";!function(){const e=require("../modules/personalDetails"),t=require("./details.sessions");let s=function(){function s(s){if(s.isNetworkError)this.isNetworkError=!0;else{var i,r;s.broken&&(this.broken=!0),this.passportInfo=null!==(i=s.data.passportInfo)&&void 0!==i?i:{empty:!0},this.personalDetails=new e(this.$services.userData.userData,this.passportInfo,s.data.personalDataEditHelper,s.data.countries),this.userInfo=this.$services.userData.userData,this.calendarSettings=s.data.calendarSettings,this.deleteAccountSettings=s.data.deleteAccountSettings,this.maskedCards=null!==(r=s.maskedCards)&&void 0!==r?r:s.data.maskedCards,this.canShowCardsForEdit=this.checkCanShowCardsForEdit(this.maskedCards),this.userRequisitsList=s.data.userRequisiteList,this.interests=s.data.interests,this.discountTable=s.data.discountTable,this.subsByType=s.data.subscriptions.subscribtionsByType,this.mySafety=new t(s.data.mySafety),this.settings=s.data.settings,this.wbCardBalance=0;const a=this.$services.cartService.publicBasketApiUrl;this.cancelDeleteAccountUrl=this.$router.getChildRouteByName("SpaAccountCancelDelete").path,this.editRequisiteUrl=this.$router.getChildRouteByName("SpaEditRequisite").path,this.saveRequisiteUrl=this.$router.getChildRouteByName("SpaSaveRequisite").path,this.deleteRequisiteUrl=this.$router.getChildRouteByName("SpaDeleteRequisite").path,this.addNewCardUrl=`${a}/webapi/lk/account/spa/bindnewcard`,this.removeCardUrl=`${a}/webapi/lk/account/spa/deletecard`,this.deleteCarsdUrl=`${a}/webapi/lk/account/spa/deletecards`,this.setCardAsDefaultUrl=`${a}/webapi/lk/account/spa/setasdefault`,this.getBicUrl=this.$router.getChildRouteByName("SpaGetBicSuggestions").path,this.updateSubscribtionsUrl=this.$router.getChildRouteByName("SpaAccountSubscriptionsSave").path,this.init(),this.externalIdentityClosed=!wb.global.settings.switches.enableTinkoffIdentification||this.userInfo.isIdentityVerified}}var i=s.prototype;return i.onBeforeRender=async function(){if(this.isNetworkError)this.loadingError=await this.$getLoadingError();else{if(await this.$user.getWbxId()){const{positions:e,debtPositions:t}=await this.$services.groupedDeliveriesService.initWbxDeliveriesInfo;this.deleteAccountSettings.hasActiveShipping=(null==e?void 0:e.length)>0,this.deleteAccountSettings.hasDeliveryDebt=(null==t?void 0:t.length)>0}}},i.onAfterRender=function(){this.$user.getBalance().then(e=>{$.observable(this.deleteAccountSettings).setProperty({balance:e.moneyBalance})}),window.location.hash.length&&this.$moveToAnchor(window.location.hash.slice(1)),this.externalIdentityClosed||this.$analitic.sendEvent("LK_Account_Confirmation_S",{type:"Tinkoff"}),this.settings.sbpSubscribe&&this.$analitic.sendEvent("Subscribes_SBP_Payment_S",{location:"LK"})},i.getScreenName=function(){return"LK"},i.init=function(){this.userInfo.hasOwnProperty("reactiveGender")||Object.defineProperty(this.userInfo,"reactiveGender",{get(){var e;return null!==(e=this.genderE)&&void 0!==e?e:""},set:e=>(WbSpaModel.prototype.$services.userData.updateSexAsync(e).then(e=>{e.isSuccess||wb.popup.renderModalError(e.error)}),!0)}),Object.entries(this.calendarSettings).forEach(([e,t])=>{this.calendarSettings[e]=new Date(t)})},i.checkCanShowCardsForEdit=function(e){var t;return(null===(t=e.filter(e=>!e.markedAsDeleted&&!e.isWbCard))||void 0===t?void 0:t.length)>0},i.editCards=async function(){await $.views.loadTemplateAsync("spaEditBankCards");const e=(e,t=!0)=>{$.observable(e).setProperty("markedAsDeleted",t)},t=(e,t)=>{$.observable(e).setProperty("changed",t),$.observable(e).setProperty("canShowCardsList",this.checkCanShowCardsForEdit(e.maskedCards))},s={maskedCards:this.maskedCards,canShowCardsList:this.checkCanShowCardsForEdit(this.maskedCards),markAsDelete:i=>{const{data:r}=$.view(i.currentTarget);e(r,!0),t(s,!0)},updateBankCards:async()=>{if(!s.changed)return i.close();try{s.updating=!0;const e={cardIds:this.maskedCards.filter(e=>e.markedAsDeleted).map(e=>e.id),paymentCode:"crd"};await this.$httpClient.fetchJSON(this.deleteCarsdUrl,{method:"POST",credentials:"include",body:this.$helper.objectSerializer(e)});try{this.maskedCards.filter(e=>e.markedAsDeleted).map(e=>{e.isSbp&&this.$analitic.sendEvent("Subscribes_SBP_Payment_Delete",{name:e.name})})}catch(e){}i.close(),t(s,!1);const r=this.maskedCards.filter(e=>!e.markedAsDeleted);$.observable(this).setProperty({maskedCards:r,canShowCardsForEdit:this.checkCanShowCardsForEdit(r)}),this.maskedCards.length>0&&!this.maskedCards.find(e=>e.default)&&this.setAsDefault(0),s.updating=!1}catch(e){console.log(e.message),wb.popup.renderModalError(e.message)}},cancelUpdateBankCardsBtn:()=>{i.close(),s.cancelUpdateBankCards()},cancelUpdateBankCards:()=>{this.maskedCards.forEach(t=>{e(t,!1)}),t(s,!1)}},i=wb.popup.showCustomPopup({useCenteredFunction:!0,useHtml:!0,popupClassesList:["popup-edit-cards","shown"],contentClasses:["popup__content"],onShow:e=>{$.templates.spaEditBankCards.link(e.querySelector(".popup__content"),s)},onHide:()=>{s.updating||s.cancelUpdateBankCards()}})},i.bindNewCard=function(e){e.preventDefault(),e.stopPropagation(),fetch(this.addNewCardUrl,{method:"POST",credentials:"include",body:new URLSearchParams({paymentCode:"crd",returnUrl:`${window.location.href}?r=`})}).then(e=>e.json()).then(e=>{$.processResponse(e,void 0,wb.popup.renderModalError)})},i.bindNewSbp=function(e){e.preventDefault(),e.stopPropagation(),this.$moduleLoader.loadModuleAsync("bindNewSbp").then(e=>{(new e).start({onSuccessBind:this._updateCards.bind(this),returnUrl:`https://www.wildberries.ru${window.location.pathname}#bankCard`});try{this.$analitic.sendEvent("Subscribes_SBP_Payment_T",{location:"LK"})}catch(e){}})},i._updateCards=async function(){const e=await this.$httpClient.fetchJSON(`${WbSpaModel.prototype.$services.cartService.publicBasketApiUrl}/webapi/lk/bankcards`,{method:"POST",credentials:"include",body:new URLSearchParams({currency:this.$user.getCurrency()})},{timeout:6e3}),t=null==e?void 0:e.maskedCards;if((null==t?void 0:t.length)>0){try{const e=t.filter(e=>e.isSbp&&this.maskedCards.some(t=>t.id!==e.id))[0];e&&this.$analitic.sendEvent("Subscribes_SBP_Payment_Ok",{location:"LK",name:e.name})}catch(e){}this.asObservable(this.maskedCards).refresh(t)}},i.deleteCard=function(e,t){t.preventDefault(),t.stopPropagation();const s=this.maskedCards[e];this._confirmDeleteActionAsync({isCard:!0,name:s.name},this._deleteCardInternalAsync,s,e);try{s.isSbp&&this.$analitic.sendEvent("Subscribes_SBP_Payment_Delete",{name:s.name})}catch(t){}},i.setAsDefault=function(e){const t=this.maskedCards[e];this.$httpClient.fetchJSON(this.setCardAsDefaultUrl,{method:"POST",credentials:"include",body:new URLSearchParams({cardId:t.id||t.sId,paymentCode:"crd"})}).then(()=>{this.maskedCards.forEach((t,s)=>{this.asObservable(this.maskedCards[s]).setProperty({default:e===s})})}).catch(e=>wb.popup.renderModalError(e))},i._deleteCardInternalAsync=async function(e,t){try{await this.$httpClient.fetchJSON(this.removeCardUrl,{method:"POST",credentials:"include",body:new URLSearchParams({cardId:e.id||e.sId,paymentCode:"crd"})}),$.observable(this.maskedCards).remove(t)}catch(e){console.log(e.message),wb.popup.renderModalError(e.message)}},i.deleteAccount=function(e,t,s,i){i.preventDefault(),i.stopPropagation(),this.deleteAccountSettings.isServiceDown?wb.popup.renderModalError("На данный момент сервис не доступен. Попробуйте позже"):Promise.all([$.views.loadTemplateAsync("spadeleteaccountpopup"),this.$moduleLoader.loadModuleAsync("spaMobileController")]).then(([i,r])=>{const a={mobileController:new r({requestUrl:e,checkUrl:t}),noTriesToSubmit:!0,formIsTouched:!1,reason:"",ifFirstStep:!0,inputBanned:!1,formattedPhoneMobile:this.userInfo.formattedPhoneMobile,msg:{},checkConfirmCode:(e,t)=>{var s;$.observable(a).setProperty({confirmCode:null===(s=a.confirmCode)||void 0===s?void 0:s.replace(/\D/g,""),formIsTouched:!0}),e.validate()&&$.observable(a.mobileController).setProperty("errorMessage",null)},requestDeleteAccount:(e,t)=>{t.preventDefault();const i=t.target.form;e.validate()&&fetch(i.action,{method:"POST",body:new URLSearchParams(new FormData(i))}).then(e=>e.json()).then(e=>{$.processResponse(e,()=>{o.close();try{this.$moduleLoader.loadModuleAsync("bottomNotificationPanel").then(e=>{e.showNotification(e.notificationsType.bottomCustomMsg,s)})}catch(e){console.error(e)}wb.spa.afterSignOut()},e=>{$.observable(a).setProperty({confirmCode:"",inputBanned:e.startsWith(a.msg.spaDelete_OutOfRequestAttempts)}),$.observable(a.mobileController).setProperty({errorMessage:e})})})},sendCode:function(e,t){$.observable(this).setProperty("noTriesToSubmit",!1),e.validate()&&($.observable(this).setProperty("ifFirstStep",!1),a.mobileController.requestCodeHandler())},backToFirstStep:function(){$.observable(this).setProperty({ifFirstStep:!0,formIsTouched:!1,inputBanned:!1,confirmCode:""}),$.observable(a.mobileController).setProperty("errorMessage",null)}},o=wb.popup.showCustomPopup({useCenteredFunction:!0,useHtml:!0,popupClassesList:["popup-delete-account","shown"],contentClasses:["popup__content"],onShow:e=>{var t,s;i.link(e.querySelector(".popup__content"),a),null===(t=e.querySelector("form"))||void 0===t||t.addEventListener("submit",e=>e.preventDefault()),a.msg.spaDelete_OutOfRequestAttempts=(null===(s=document.getElementById("spaDelete_OutOfRequestAttempts"))||void 0===s?void 0:s.value)||"Вы исчерпали"}})})},i.cancelDeleteAccount=function(e){e.preventDefault(),e.stopPropagation(),fetch(this.cancelDeleteAccountUrl,{method:"POST"}).then(e=>e.json()).then(e=>{$.processResponse(e,e=>$.observable(this.deleteAccountSettings).setProperty(e),void 0)})},i.editRequisite=function(e,t){t.preventDefault(),t.stopPropagation(),(null==this.requisiteEditor?this._getRequiseteEditor():Promise.resolve()).then(()=>{this.requisiteEditor.show(e)})},i.deleteRequisite=function(e,t){t.preventDefault(),t.stopPropagation(),this._confirmDeleteActionAsync({isCard:!1,name:e.bankName},this._deleteRequisiteUnternalAsync,e.id)},i._deleteRequisiteUnternalAsync=async function(e){try{const t=await this.$httpClient.fetchJSON(this.deleteRequisiteUrl,{method:"POST",body:new URLSearchParams({id:e})});$.observable(this.userRequisitsList).refresh(t)}catch(e){console.error(e.message),wb.popup.renderModalError(e.message)}},i._getRequiseteEditor=function(){return this.$moduleLoader.loadModuleAsync("requisiteEditor").then(e=>(this.requisiteEditor=new e({template:e.template,mobileControllerData:e.data,urls:{editRequisiteUrl:this.editRequisiteUrl,saveRequisiteUrl:this.saveRequisiteUrl,getBicSuggets:this.getBicUrl},requisiteList:this.userRequisitsList}),Promise.resolve()))},i.updateUserPhoto=function(e,t){const s=t.linkCtx.elem;0!=s.files.length&&this.$moduleLoader.loadModuleAsync("userImageAdder").then(e=>{new e(e.data,e.template,e=>{this._updateUserPhotoState(e,!0)}).showPopupAsync(s.files[0]),s.value=null})},i.removeUserPhoto=function(){this.$services.userData.removeUserPhotoAsync().then(e=>{e.isSuccess||wb.popup.renderModalError(e.error)})},i.updateSubs=function(e){let t=$.view(e.target).data;this.asObservable(t).setProperty({isSubscribed:!t.isSubscribed});const s=Object.keys(this.subsByType).reduce((e,t)=>{let s=this.subsByType[t].subscribtions.filter(e=>e.isSubscribed).map(e=>e.id);return e.push(...s),e},[]);fetch(this.updateSubscribtionsUrl,{method:"POST",body:new URLSearchParams({ids:s.join(";")})}).then(e=>e.json()).then(e=>{$.processResponse(e,()=>{},e=>wb.popup.renderModalError(e,"red"))})},i._confirmDeleteActionAsync=async function(e,t,...s){await wb.popup.confirm($.views.templates.deleteCardOrRequisite.render(e),{yes:"Удалить",no:"Отменить",noBtnClassList:["btn-minor"],classList:["shown","popup-delete-card"]})&&t.apply(this,s)},i.showExternalIdentity=function(){this.$moduleLoader.loadModuleAsync("externalIdentity").then(e=>new e("LK_Account_Confirmation_T").showPopup())},s}();wb.spa.registerViewModel(s)}();

},{"../modules/personalDetails":3,"./details.sessions":2}],2:[function(require,module,exports){
"use strict";function _inheritsLoose(s,o){s.prototype=Object.create(o.prototype),s.prototype.constructor=s,_setPrototypeOf(s,o)}function _setPrototypeOf(s,o){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,o){return s.__proto__=o,s})(s,o)}let SessionsViewModel=function(s){function o(o){var e;return(e=s.call(this)||this).sessions=o.sessions,e.canFinishOtherSessions=o.canFinishOtherSessions,e.otherSessionsFinished=!1,e.showOtherSessions=!1,e.finishSessionUrl=e.$router.getChildRouteByName("SpaAccountFinishSession").path,e.finishAllSessionUrl=e.$router.getChildRouteByName("SpaAccountFinishAllSession").path,e.mobileControllerView=o.mobileControllerView,e}_inheritsLoose(o,s);var e=o.prototype;return e._finishSession=function(s,o){fetch(this.finishSessionUrl,{method:"POST",body:new URLSearchParams({sessionId:s})}).then(s=>s.json()).then(s=>{$.processResponse(s,()=>{$.observable(this.sessions).remove(o)},wb.popup.renderModalError)}).catch(s=>{console.error(s.message),wb.popup.renderModalError("Error")})},e._finishOtherSessions=function(){fetch(this.finishAllSessionUrl,{method:"POST"}).then(s=>s.json()).then(s=>{$.processResponse(s,()=>{$.observable(this.sessions).remove(1,this.sessions.length),$.observable(this).setProperty("otherSessionsFinished",!0)},wb.popup.renderModalError)}).catch(s=>{console.error(s.message),wb.popup.renderModalError("Error")})},e.finishSession=function(s,o){this.canFinishOtherSessions?this._finishSession(s,o):this._showSmsConfirmationPopup(()=>{this._unlockSessionFinish(),this._finishSession(s,o)})},e.finishOtherSessions=function(){this.canFinishOtherSessions?this._finishOtherSessions():this._showSmsConfirmationPopup(()=>{this._unlockSessionFinish(),this._finishOtherSessions()})},e.toggleShowOtherSessions=function(){$.observable(this).setProperty("showOtherSessions",!this.showOtherSessions)},e._unlockSessionFinish=function(){this.confirmPopup.close(),$.observable(this).setProperty("canFinishOtherSessions",!0)},e._showSmsConfirmationPopup=function(s){Promise.all([this.$moduleLoader.loadModuleAsync("spaMobileController"),$.views.loadTemplateAsync("spasmsconfirmationpopup")]).then(([o,e])=>{let i=new ConfirmCloseSessionsPopup(this.mobileControllerView,o,s);this.confirmPopup=wb.popup.showCustomPopup({useCenteredFunction:!0,useHtml:!0,popupClassesList:["popup-confirm-code","shown"],contentClasses:["content"],onShow:s=>{e.link(s.querySelector(".content"),i)}})})},o}(WbSpaModel),ConfirmCloseSessionsPopup=function(s,o,e){this.mobileController=new o(s,{onSuccess:e}),this.title=s.title,this.text=s.text};module.exports=SessionsViewModel;

},{}],3:[function(require,module,exports){
"use strict";function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}let PersonalDetails=function(e){function t(t,o,r,s){var i;return(i=e.call(this)||this).userInfo=t,i.passportInfo=o,i.helper=r,i.countries=s,i}_inheritsLoose(t,e);var o=t.prototype;return o.editFioPopup=function(e){this._loadRequiredResources("spaaccounteditfio").then(t=>{this._showConfirmSmsPopup(new EditFioPopupViewModel({observableObject:this.userInfo,firstStepTemplate:t.templates.secondStepTemplate,secondStepTemplate:t.templates.secondStepTemplate,mobileController:t.mobileConroller,requestCodeUrl:this.helper[e].requestUrl,confirmCodeUrl:this.helper[e].checkUrl,title:this.helper[e].title}),"popup-edit-name")})},o.editPassportPopup=function(e){("uz"===wb.settings.currentLocale?this._loadRequiredResources("spaaccounteditpassportuz"):this._loadRequiredResources("spaaccounteditpassport")).then(async t=>{var{disabled:o}=await this.$httpClient.fetchJSON(this.$router.urls.deletePassportCondition,{method:"POST"});this._showConfirmSmsPopup(new EditPassportPopupViewModel({observableObject:this.passportInfo,firstStepTemplate:t.templates.secondStepTemplate,secondStepTemplate:t.templates.secondStepTemplate,mobileController:t.mobileConroller,requestCodeUrl:this.helper[e].requestUrl,confirmCodeUrl:this.helper[e].checkUrl,title:this.helper[e].title,deleteDisabled:o}),"popup-edit-passport-data")})},o.editPhone=function(e){this._loadRequiredResources("spaaccounteditphone").then(t=>{this._showConfirmSmsPopup(new EditPhonePopupViewModel({observableObject:this.userInfo,firstStepTemplate:t.templates.firstStepTemplate,secondStepTemplate:t.templates.secondStepTemplate,mobileController:t.mobileConroller,requestCodeUrl:this.helper[e].requestUrl,confirmCodeUrl:this.helper[e].checkUrl,title:this.helper[e].title,countries:this.countries}),"popup-edit-phone")})},o.editEmail=function(e){this._loadRequiredResources("spaaccounteditemail").then(t=>{this._showConfirmSmsPopup(new EditEmailPopupViewModel({observableObject:this.userInfo,firstStepTemplate:t.templates.secondStepTemplate,secondStepTemplate:t.templates.secondStepTemplate,mobileController:t.mobileConroller,requestCodeUrl:this.helper[e].requestUrl,confirmCodeUrl:this.helper[e].checkUrl,title:this.helper[e].title}),"popup-edit-email")})},o.editInn=function(e){this._loadRequiredResources("spaaccounteditinn").then(t=>{this._showConfirmSmsPopup(new EditInnPopupViewModel({observableObject:this.userInfo,firstStepTemplate:t.templates.secondStepTemplate,secondStepTemplate:t.templates.secondStepTemplate,mobileController:t.mobileConroller,requestCodeUrl:this.helper[e].requestUrl,confirmCodeUrl:this.helper[e].checkUrl,title:this.helper[e].title}),"popup-edit-inn")})},o.editBirthday=function(){const e=document.querySelector("#datePickerInput input").value;this.$services.userData.updateBirthdayAsync(e).then(e=>{e.isSuccess||wb.popup.renderModalError(e.error)})},o._loadRequiredResources=function(e){return Promise.all([this._loadRequiredTemplates(e),this.$moduleLoader.loadModuleAsync("spaMobileController")]).then(([e,t])=>Promise.resolve({mobileConroller:t,templates:e}))},o._loadRequiredTemplates=function(e){return Promise.all([$.views.loadTemplateAsync("spaeditpersonaldatapopup"),$.views.loadTemplateAsync(e)]).then(([e,t])=>Promise.resolve({firstStepTemplate:e,secondStepTemplate:t}))},o._showConfirmSmsPopup=function(e,t){const o=["shown"];null!=t&&""!=t&&o.push(t);const r=wb.popup.showCustomPopup({useCenteredFunction:!0,useHtml:!0,popupClassesList:o,contentClasses:["popup__content"],onShow:t=>{e instanceof EditPhonePopupViewModel&&!this.userInfo.formattedPhoneMobile&&e.onCodeConfirmed(),$.templates.detailsConfirmSMSPopup.link(t.querySelector(".popup__content"),e),this.$helper.nextTick().then(()=>{e.setPopup(r)})}})},t}(WbSpaModel),BaseConfirmPopupViewModel=function(e){function t(t){var o;o=e.call(this,t)||this;const r=new t.mobileController({requestUrl:t.requestCodeUrl,checkUrl:t.confirmCodeUrl},{onSuccess:o.onCodeConfirmed.bind(_assertThisInitialized(o))});return o.title=t.title,o.mobileController=r,o.observableObject=t.observableObject,o.currentTemplate=t.firstStepTemplate,o.firstStepTemplate=t.firstStepTemplate,o.secondStepTemplate=t.secondStepTemplate,o.confirmCode="",o.noTriesToSubmit=!0,o}_inheritsLoose(t,e);var o=t.prototype;return o.onCodeConfirmed=function(){var e;null===(e=this.onCodeConfirmedLocal)||void 0===e||e.call(this),$.observable(this).setProperty("currentTemplate",this.secondStepTemplate),this.$helper.nextTick().then(()=>{this.popup.centered()})},o.setPopup=function(e){this.popup=e},o.closePopup=function(e){e&&e.preventDefault(),e&&e.stopPropagation(),this.popup.close()},t}(WbSpaModel),EditPassportPopupViewModel=function(e){function t(t){var o,r,s,i,n;return(n=e.call(this,t)||this).passport={number:null===(o=t.observableObject)||void 0===o?void 0:o.number,issueDate:null===(r=t.observableObject)||void 0===r?void 0:r.issueDate,issuedBy:null===(s=t.observableObject)||void 0===s?void 0:s.issuedBy,deletedDisabled:t.deletedDisabled,pinfl:null===(i=t.observableObject)||void 0===i?void 0:i.pinfl},n}_inheritsLoose(t,e);var o=t.prototype;return o.setPassportIssueDate=function(e){$.observable(this.passport).setProperty({issueDate:e})},o.setPassportNumber=function(e){$.observable(this.passport).setProperty({number:e})},o.setPassportPinfl=function(e){$.observable(this.passport).setProperty({pinfl:e})},o.updatePassportInfo=function(e){this.noTriesToSubmit&&$.observable(this).setProperty("noTriesToSubmit",!1);const t=e.target.closest("form"),o=$.view(t).ctx.tag;o.validate()&&fetch(t.action,{method:"POST",body:new URLSearchParams(new FormData(t))}).then(e=>e.json()).then(e=>{$.processResponse(e,e=>{this.observableObject||$.observable(this).setProperty({observableObject:{}}),$.observable(this.observableObject).setProperty({empty:!1,number:e.passportInfo.number,issueDate:e.passportInfo.issueDate,issuedBy:e.passportInfo.issuedBy,pinfl:e.passportInfo.pinfl}),this.closePopup()},o.showDictionaryErrors)}).catch(console.error)},o.deletePassportInfo=function(e){wb.popup.confirm($.localize("Вы желаете удалить паспортные данные?")).then(e=>{e&&this.$httpClient.fetchJSON(this.$router.urls.deletePassport,{method:"POST"}).then(()=>{$.observable(this.observableObject).setProperty({empty:!0,number:null,issueDate:null,issuedBy:null,pinfl:null}),this.closePopup()}).catch(e=>wb.popup.renderModalError(e.message))})},t}(BaseConfirmPopupViewModel),EditFioPopupViewModel=function(e){function t(t){var o;return(o=e.call(this,t)||this).firstName=t.observableObject.firstName,o.lastName=t.observableObject.lastName,o.middleName=t.observableObject.middleName,o}return _inheritsLoose(t,e),t.prototype.updateUserInfo=function(e){e.preventDefault(),e.stopPropagation(),this.noTriesToSubmit&&$.observable(this).setProperty("noTriesToSubmit",!1);const t=e.target.closest("form"),o=$.view(t).ctx.tag;o.validate()&&this.$services.userData.updateFioAsync(this.firstName,this.lastName,this.middleName).then(e=>(e.isSuccess,this.closePopup())).catch(e=>{wb.popup.renderModalError(e.isCustomError?e.message:this.$localziation.serverError)})},t}(BaseConfirmPopupViewModel),EditPhonePopupViewModel=function(e){function t(t){var o;return(o=e.call(this,t)||this)._fancyPhone="",o.fullPhoneMobile="",o.stage=2,o.countries=t.countries.map(e=>({name:e.phoneCode,value:e.langCode,mask:e.phoneMask,current:e.current})),o.selectedCountry=o.countries.find(e=>e.current)||o.countries[0],o}_inheritsLoose(t,e);var o=t.prototype;return o.onCodeConfirmedLocal=function(){this.mobileController.reset(),this.mobileController.onSuccess=null,$.observable(this).setProperty({confirmCode:""}),$.observable(this.mobileController).setProperty("canSendCode",!0)},o.updatePhone=function(e){e.preventDefault(),this.$services.userData.updatePhoneMobileAsync(this.stage,this.fullPhoneMobile,this.confirmCode).then(e=>{if(e.isSuccess)return this.closePopup();wb.popup.renderModalError(e.error)})},_createClass(t,[{key:"fancyPhone",get:function(){return this._fancyPhone},set:function(e){return this._fancyPhone=e,$.observable(this).setProperty("fullPhoneMobile",e.replace(/[^0-9.]/g,"")),!0}}]),t}(BaseConfirmPopupViewModel),EditEmailPopupViewModel=function(e){function t(t){return e.call(this,t)||this}return _inheritsLoose(t,e),t.prototype.updateEmail=function(e){e.preventDefault(),e.stopPropagation(),this.noTriesToSubmit&&$.observable(this).setProperty("noTriesToSubmit",!1);const t=e.target.closest("form");$.view(t).ctx.tag.validate()&&this.$services.userData.updateEmailAsync(this.email).then(e=>{if(e.isSuccess)return this.closePopup(),void wb.popup.renderModalError($.templates.emailChangedNeedConfirm.render(),"popup-update-email","",!1,!0);const t=document.querySelector(".j-error-email");if(null==t)return console.error("label for email validation error doesnt exist");t.classList.add("field-validation-error"),t.textContent=e.error})},t}(BaseConfirmPopupViewModel),EditInnPopupViewModel=function(e){function t(t){var o;return(o=e.call(this,t)||this).inn=t.observableObject.inn>0?t.observableObject.inn:null,o}return _inheritsLoose(t,e),t.prototype.updateInn=function(e){e.preventDefault(),e.stopPropagation(),this.noTriesToSubmit&&$.observable(this).setProperty("noTriesToSubmit",!1);const t=e.target.closest("form");$.view(t).ctx.tag.validate()&&this.$services.userData.updateInnAsync(this.inn).then(e=>{if(e.isSuccess)return this.closePopup();const t=document.querySelector(".j-error-inn");if(null==t)return console.error("label for email validation error doesnt exist");t.classList.remove("field-validation-valid"),t.textContent=e.error})},t}(BaseConfirmPopupViewModel);module.exports=PersonalDetails;

},{}]},{},[1]);
