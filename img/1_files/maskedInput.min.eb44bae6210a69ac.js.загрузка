$.views.tags({maskedInput:{displayElement:"input",template:`<input class="input-item" type="text" autocomplete="off" data-link="{on 'blur' ~tag.onBlur}{on 'focus' ~tag.onFocus}
                        {on 'keydown' ~tag.onKeyPress}{on 'input' ~tag.onInput}{on 'mouseup' ~tag.onMouseUp}
                        {on 'paste' ~tag.onInput}{:~tag.currentValue}disabled{:~tagCtx.props.disabled}
                        readonly{:~tagCtx.props.readonly || false}class{merge:~tagCtx.props.disabled toggle='input-validation-error'}
                        placeholder{:~tag.inputPlaceholder}id{:~tagCtx.props.id}">`,init(t){var e=t.props.mask.split("?"),s=e[0];this.optionalMaskTemplate=1<e.length?e[1]:"",this.optionalMask=this.optionalMaskTemplate.split(""),this.filledOptional=[],this.mask=s,this.onCompleted=t.props.onComplete,this.onReset=t.props.onReset,this.onBlurCallback=t.props.onBlurCallback,this.onFocusCallback=t.props.onFocusCallback,this.onKeyPressCallback=t.props.onKeyPressCallback,t.props.tmpl&&(this.template=t.props.tmpl),this.disabled=t.props.disabled||!1,this.inputPlaceholder=t.props.placeholder||"",this.originalMessage=s.split(""),this.maskedArray=s.split(""),this.currentMessage=s.replace(new RegExp(`[${Object.keys(this.settings.definitions).join("")}]`,"g"),this.settings.placeholder).split(""),this.currentOptionalMessage=this.optionalMaskTemplate.replace(new RegExp(`[${Object.keys(this.settings.definitions).join("")}]`,"g"),this.settings.placeholder).split(""),this.pointer=this.findCurrentPointer(this.maskedArray),Object.defineProperty(this,"fistItemToChange",{writable:!1,value:this.pointer}),t.args[0]&&this.tryToFill(""+t.args[0])},settings:{placeholder:"_",definitions:{"#":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}},findCurrentPointer(t){return t.findIndex(t=>this.settings.definitions[t])},currentValue:"",originalMessage:null,currentMessage:null,maskedArray:null,pointer:null,completed:!1,onFocus(t){var e;null!=(e=this.onFocusCallback)&&e.call(this,t),!this.completed&&t.target.value&&this.tryToFill(t.target.value),this.completed||($.observable(this).setProperty("currentValue",this.currentMessage.concat(this.currentOptionalMessage).join("")),this.updateValues(this.currentValue),t.target.setSelectionRange(this.pointer,this.pointer))},onMouseUp(t){this.completed||t.target.setSelectionRange(this.pointer,this.pointer)},onInput(t){this.hack=!0,setTimeout(()=>{this.tryToFill(t.target.value),this.hack=!1},0)},onBlur(t){var e;null!=(e=this.onBlurCallback)&&e.call(this,t,this),this.completed||this.hack||(this.currentMessage=this.originalMessage.map(t=>this.settings.definitions[t]?this.settings.placeholder:t),this.currentOptionalMessage=this.optionalMask.map(t=>this.settings.definitions[t]?this.settings.placeholder:t),this.maskedArray=[...this.mask],this.optionalMask=[...this.optionalMaskTemplate],this.filledOptional=[],this.pointer=this.fistItemToChange,$.observable(this).setProperty("currentValue",""),this.updateValues(this.currentValue),null!=(e=this.onReset)&&e.call(this))},getOriginalWithOptional(){return this.originalMessage.concat(this.filledOptional.map((t,e)=>this.optionalMaskTemplate[e]))},onKeyPress(e){null!=(s=this.onKeyPressCallback)&&s.call(this,e,this);var s=e.target,i=96<=e.keyCode&&e.keyCode<=105?e.keyCode-48:e.keyCode;if(!("Tab"===e.key||e.ctrlKey||e.altKey||e.metaKey||37<=i&&i<=40||112<=i&&i<=123)){if(e.preventDefault(),8==i||46==i){var a=s.selectionStart,n=s.selectionEnd,l=n!==a;if(this.completed=1<=this.filledOptional.length,a<=this.fistItemToChange&&n<=this.fistItemToChange)return void e.preventDefault();a=Math.max(a,this.fistItemToChange);let t;var e=this.getOriginalWithOptional(),l=(t=46==i||l?a+e.slice(a).findIndex(t=>this.settings.definitions[t]):a-e.slice(0,a).reverse().findIndex(t=>this.settings.definitions[t])-1,l?e.slice(a,n).filter(t=>this.settings.definitions[t]).length:1);this.replaceWithPlaceholder(t,l),this.pointer=t}else{if(this.completed&&(0==this.optionalMask.length||-1==this.findCurrentPointer(this.optionalMask)))return;e=String.fromCharCode(i);new RegExp(this.settings.definitions[this.maskedArray.concat(this.optionalMask)[this.pointer]]).test(e)&&(a=this.findCurrentPointer(this.optionalMask),-1==this.pointer&&0<this.optionalMask.length?0<=a&&(this.optionalMask[a]=e,this.currentOptionalMessage[a]=e,this.filledOptional=this.optionalMask.slice(0,a+1)):(n=this.findCurrentPointer(this.maskedArray),this.currentMessage[n]=e,this.maskedArray[n]=e,this.pointer=this.findCurrentPointer(this.maskedArray)))}$.observable(this).setProperty("currentValue",this.currentMessage.concat(this.currentOptionalMessage).join("")),this.updateValues(this.currentValue);let t=this.pointer;-1==t&&0<this.filledOptional.length&&(t=this.maskedArray.length+this.filledOptional.length),s.setSelectionRange(t,t),-1==this.pointer&&(this.completed=!0,null!=(l=this.onCompleted))&&l.call(this,this.currentValue)}},replaceWithPlaceholder(e,s){let i=0;var a,n=this.getOriginalWithOptional();for(let t=e;t<n.length;t++)!this.settings.definitions[n[t]]||i>=s||(t>=this.originalMessage.length?-1<(a=t-(n.length-this.filledOptional.length))&&a<this.optionalMask.length&&(this.optionalMask[a]=this.optionalMaskTemplate[a],this.currentOptionalMessage[a]=this.optionalMaskTemplate[a],this.filledOptional=this.filledOptional.slice(0,a)):this.maskedArray[t]=this.originalMessage[t],i++);this.currentMessage=this.maskedArray.map(t=>this.settings.definitions[t]?this.settings.placeholder:t),this.currentOptionalMessage=this.currentOptionalMessage.map(t=>this.settings.definitions[t]?this.settings.placeholder:t)},tryToFill(e){var t;let s,i=0;for(let t=0;t<this.originalMessage.length;t++)if(this.settings.definitions[this.originalMessage[t]]){for(this.maskedArray[t]=this.settings.placeholder;i++<e.length;)if(s=e.charAt(i-1),new RegExp(this.settings.definitions[this.originalMessage[t]]).test(s)){this.maskedArray[t]=s;break}if(i>e.length)break}else this.maskedArray[t]===e.charAt(i)&&i++;this.currentMessage=this.maskedArray.map(t=>this.settings.definitions[t]?this.settings.placeholder:t),$.observable(this).setProperty({currentValue:this.currentMessage.join(""),completed:!this.maskedArray.some(t=>this.settings.definitions[t])}),null!=(t=this.updateValues)&&t.call(this,this.currentValue),this.completed&&null!=(t=this.onCompleted)&&t.call(this,this.currentValue)},convertBack(){return this.currentValue},reset(){this.currentMessage=this.originalMessage.map(t=>this.settings.definitions[t]?this.settings.placeholder:t),this.currentOptionalMessage=this.optionalMask.map(t=>this.settings.definitions[t]?this.settings.placeholder:t),this.maskedArray=[...this.mask],this.optionalMask=[...this.optionalMaskTemplate],this.filledOptional=[],this.pointer=this.fistItemToChange,$.observable(this).setProperty({currentValue:"",completed:!1}),this.updateValues(this.currentValue)}}});